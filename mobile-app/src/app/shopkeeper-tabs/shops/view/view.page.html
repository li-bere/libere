<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>View Shop</ion-title>
    <ion-buttons slot="end">
      <app-spinner *ngIf="loading"></app-spinner>
      <ion-button [routerLink]="['/shopkeeper-tabs/shops/edit', id]">
        <ion-icon slot="icon-only" ios="pencil-outline" md="pencil"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <div class="ion-text-center content-header" *ngIf="shop">
    <div class="img-profile">
      <img
        class="ion-margin-bottom"
        [src]="shop.shopDisplayPhoto"
        *ngIf="shop.shopDisplayPhoto"
      />
      <img
        class="ion-margin-bottom"
        src="/assets/img/profile-image-placeholder.png"
        *ngIf="!shop.shopDisplayPhoto"
      />
      <app-spinner *ngIf="photoLoading"></app-spinner>
      <ion-fab-button color="light" (click)="presentActionSheet()"
        ><ion-icon ios="camera-outline" md="camera"></ion-icon
      ></ion-fab-button>
    </div>


    <p class="ion-no-margin ion-margin-bottom">{{shop.name}}</p>
    <p class="ion-no-margin">@{{shop.shopId}}</p>
    <p class="ion-no-margin ion-margin-bottom">{{shop.phone.internationalNumber}}</p>
  </div>

  <div class="ion-margin-bottom info" *ngIf="shop" [style.border-right-color]="shop.color">
    <a class="ion-padding-end" [routerLink]="['/shopkeeper-tabs/transactions']">
      <ion-icon ios="cash-outline" md="cash" color="primary"></ion-icon>
      <p class="ion-no-margin">
        <ion-text color="medium" *ngIf="shop.credit"
          >{{shop.credit}} Credits</ion-text
        >
        <ion-text color="medium" *ngIf="!shop.credit"
          >0 Credits</ion-text
        >
      </p>
    </a>
    <a
      class="ion-padding-start" (click)="openRefillTab()"
    >
      <ion-icon ios="wine" md="wine" color="primary"></ion-icon>
      
      <p class="ion-no-margin">
        <ion-text color="medium" *ngIf="shop.refills"
          >{{shop.refills}} Refill<span *ngIf="shop.refills > 1"
            ></span
          ></ion-text
        >
        <ion-text color="medium" *ngIf="!shop.refills"
          >0 Refill</ion-text
        >
      </p>
    </a>
    <!-- <ion-icon class="ion-margin-start" name="ellipse" [style.color]=shop.color slot="end"></ion-icon> -->
  </div>

  <div class="rating-content" *ngIf="shop">
    <h3>{{ shop.rating }}</h3>
    <ion-card (click)="goToAllRatingsPage()">
      <!-- <ion-icon name="star" color="warning" slot="start"></ion-icon> -->
      <rating [(ngModel)]="shop.rating" readonly="true" size="default"></rating>
    </ion-card>
  </div>
  <ion-card>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <ion-item>
              <ion-label position="stacked">
                CO2
              </ion-label>
              {{co2}}
            </ion-item>
          </ion-col>
          <ion-col size="6">
            <ion-item>
              <ion-label position="stacked">
                PLA
              </ion-label>
              {{pla}}
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>
  <div class="view-all-transactions">
    <ion-button expand="block" (click)="gotoShopsTransactionsPage(id)">View All Transactions</ion-button>
  </div>

  <ion-toolbar>
    <ion-segment [(ngModel)]="type">
      <ion-segment-button value="shop"> Shop </ion-segment-button>
      <ion-segment-button value="refills"> Refills </ion-segment-button>
    </ion-segment>
    
  </ion-toolbar>

  <div [ngSwitch]="type">
    <div *ngSwitchCase="'shop'">
      <div *ngIf="shop">
      <ion-card class="ion-margin-bottom" *ngIf="isFountain">
        <ion-card-header>
          
          <ion-card-title>QR Code</ion-card-title>
        </ion-card-header>

        <ion-card-content class="ion-text-center">
          <ngx-qrcode
            [value]="qrData"
            [elementType]="qrCodeOptions.elementType"
            [scale]="qrCodeOptions.scale"
            #canvas
            id="canvas"
            *ngIf="qrData"
          >
          </ngx-qrcode>

          <ion-button
            expand="block"
            color="secondary"
            class="ion-margin-top"
            [disabled]="qrDownloadBtnDisabled"
            (click)="downloadQRCode()"
          >
            <ion-icon
              md="cloud-download"
              ios="cloud-download-outline"
              class="ion-margin-end"
            ></ion-icon>
            Download Your Code
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>

      <ion-card class="ion-margin-bottom" *ngIf="shop">
        <ion-card-header>
          <ion-card-title>Location</ion-card-title>
        </ion-card-header>

        <ion-list>
          <ion-item>
            <ion-icon name="home" slot="start"></ion-icon>
            <ion-label>{{shop.address.location}}</ion-label>
          </ion-item>
          <ion-item>
            <ion-icon name="home" slot="start"></ion-icon>
            <ion-label>{{shop.address.city}}</ion-label>
          </ion-item>
          <ion-item>
            <ion-icon name="home" slot="start"></ion-icon>
            <ion-label>{{shop.address.state}}</ion-label>
          </ion-item>
          <ion-item>
            <ion-icon name="home" slot="start"></ion-icon>
            <ion-label>{{shop.address.zip}}</ion-label>
          </ion-item>
        </ion-list>

        <app-location-view
          [lat]="shop.address.latLng.lat"
          [lng]="shop.address.latLng.lng"
        ></app-location-view>
      </ion-card>
    </div>

    <ion-list *ngSwitchCase="'refills'">
      <p
        class="ion-padding"
        *ngIf="refillTransactions && refillTransactions.length === 0"
      >
        No refills.
      </p>
      <ion-item lines="none" *ngFor="let transaction of refillTransactions">
        <ion-avatar slot="start">
          <ion-img
            [src]="transaction.userDisplayPhoto"
            *ngIf="transaction.userDisplayPhoto"
          ></ion-img>
          <img
            src="/assets/img/profile-image-placeholder.png"
            alt="Photo"
            *ngIf="!transaction.userDisplayPhoto"
          />
        </ion-avatar>
        <ion-label>
          <h4>
            <ion-text color="primary" class="ion-text-capitalize"
              >{{transaction.shopName}}</ion-text
            >
          </h4>
          <p *ngIf="transaction.userName">{{transaction.userName}}</p>
          <p *ngIf="!transaction.userName">Full Name</p>
        </ion-label>
        <ion-label slot="end" class="ion-text-center">
          <h3>{{transaction.amount}} Credits</h3>
        </ion-label>
      </ion-item>
    </ion-list>
  </div>
</ion-content>
